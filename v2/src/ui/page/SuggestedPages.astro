---
import dayjs from 'dayjs';
import CalendarIcon from '../../assets/CalendarIcon.astro';
import RightArrowIcon from '../../assets/RightArrowIcon.astro';
import pagesApi from '../../api/pages/pages-api';

interface Props {
	slug?: string;
	limit?: number;
	disableHintText?: boolean;
}
const { slug, limit, disableHintText } = Astro.props;

const pages = await pagesApi.getPagesRecommendation(slug ?? '', limit);
const showHintText = !disableHintText;

---

<div class="mx-auto px-5 py-5" style={{ maxWidth: 800 }}>
	{ showHintText && (
		<h4 class="text-base font-arvo text-black dark:text-white">
			You may also like:
		</h4>
		)
	}
	<div
		class="py-3 grid gap-5 grid-flow-row sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
	>
		{
			pages.map((page) => {
				const updatedAtText = page.updatedAt
					? dayjs(page.updatedAt, { locale: 'en' }).format('DD MMMM YYYY')
					: '--';

				return (
					<a href={`/${page.slug}`} class="group">
						<div class="border dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700 transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-slate-900/20 rounded-2xl overflow-hidden">
							<div class="p-6 pb-4">
								<div class="flex justify-between items-start mb-2">
									<div class="dark:bg-slate-900/80 dark:text-white dark:border-slate-600 border rounded-2xl px-2 py-1 text-xs font-medium">
										{page.slug}
									</div>
									<div class="flex items-center gap-4 text-xs dark:text-slate-500">
										<div class="flex items-center gap-1">
											<CalendarIcon class="w-3 h-3" />
											<span>{updatedAtText}</span>
										</div>
									</div>
								</div>
							</div>

							<div class="p-6 pt-0">
								<h3 class="text-xl font-semibold dark:text-white mb-3 group-hover:text-blue-400 transition-colors">
									{page.title}
								</h3>
								<p class="text-slate-600 dark:text-slate-400 text-sm leading-relaxed mb-4 line-clamp-3">{page.previewContent}</p>
							</div>

							<div class="p-6 pt-0">
								<div class="flex items-center dark:text-blue-400 text-sm font-medium dark:group-hover:text-blue-300 transition-colors">
									<span>Read more</span>
									<RightArrowIcon class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1" />
								</div>
							</div>
						</div>
					</a>
				);
			})
		}
	</div>
</div>
